generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["driverAdapters"]
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

enum WorkspaceRole {
    ADMIN
    MEMBER
}

enum PersonilRole {
  PYB
  KOORDINATOR_PPIK
  ANGGOTA_PPIK
  ANGGOTA_PPP
  KETUA_PHP
  ANGGOTA_PHP
}


enum Bulan{
    Januari
    Februari
    Maret
    April
    Mei
    Juni
    Juli
    Agustus
    September
    Oktober
    November
    Desember
}

enum TaskStatus {
    TODO
    IN_PROGRESS
    DONE
}

enum TaskType {
    TASK
    BUG
    FEATURE
    IMPROVEMENT
    OTHER
}

enum ProjectStatus {
    ACTIVE
    PLANNING
    COMPLETED
    ON_HOLD
    CANCELLED
}

enum Priority {
    LOW
    MEDIUM
    HIGH
}

model User {
    id        String   @id
    name      String
    email     String   @unique
    image     String   @default("")
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    role     String  @default("ADMIN")


    Monitoring          Monitoring[]          @relation("ProjectOwner")
    MonitoringHistory   MonitoringHistory[]   @relation("ProjectOwner")
}

model Monitoring {
    id              String   @id @default(uuid())
    nama_proyek     String
    no_kontrak      String
    tgl_kontrak     DateTime?
    nilai_proyek    Int?
    pelaksana_pekerjaan   String
    jangka_waktu    Int
    start_proyek    DateTime?
    end_proyek      DateTime?
    start_pemeliharaan  DateTime?
    masa_pemeliharaan   Int?
    end_pemeliharaan    DateTime?     
    nama_ppp        String
    nama_ppk        String
    nama_php        String
    rencana         Decimal @db.Decimal(10, 2)
    realisasi       Decimal @db.Decimal(10, 2)
    deviasi         Decimal @db.Decimal(10, 2)
    kendala         Boolean
    keterangan      String
    createdAt       DateTime @default(now())
    updatedAt       DateTime @updatedAt
    bulan           Bulan?    

    // FK 
    team_lead         String        // <--- user id disimpan di sini

    // Relasi
    owner             User      @relation("ProjectOwner", fields: [team_lead], references: [id])

    history             MonitoringHistory[] 
    RencanaKerja        RencanaKerja[]
    personil PersonilMonitoring[]
}

model MonitoringHistory {
    id              String   @id @default(uuid())

    monitoring_id   String
    monitoring      Monitoring @relation(fields: [monitoring_id], references: [id], onDelete: Cascade)
    
    nama_proyek     String
    no_kontrak      String
    tgl_kontrak     DateTime?
    nilai_proyek    Int?
    pelaksana_pekerjaan   String
    jangka_waktu    Int
    start_proyek    DateTime?
    masa_pelaksana  Int?
    end_proyek      DateTime?
    start_pemeliharaan  DateTime?
    masa_pemeliharaan   Int?
    end_pemeliharaan    DateTime?    
    nama_ppp        String
    nama_ppk        String
    nama_php        String
    rencana         Decimal @db.Decimal(10, 2)
    realisasi       Decimal @db.Decimal(10, 2)
    deviasi         Decimal @db.Decimal(10, 2)
    kendala         Boolean 
    keterangan      String
    createdAt       DateTime @default(now())
    updatedAt       DateTime @updatedAt
    bulan           Bulan?   
    team_lead       String        // user id

    owner             User      @relation("ProjectOwner", fields: [team_lead], references: [id])
}

model Tahun {
    id          String   @id @default(uuid())
    tahun       Int
    createdAt       DateTime @default(now())
}

model RencanaKerja {
  id            String   @id @default(uuid())
  monitoring_id String
  minggu        Int
  progress      Decimal @db.Decimal(10,2)

  monitoring Monitoring @relation(fields: [monitoring_id], references: [id], onDelete: Cascade)
}

model PersonilMonitoring {
  id              String   @id @default(uuid())
  nama            String
  role            PersonilRole

  monitoring_id   String
  monitoring      Monitoring @relation(fields: [monitoring_id], references: [id], onDelete: Cascade)

  // Relasi atasan-bawahan (self-relation)
  atasan_id       String?
  atasan          PersonilMonitoring? @relation("HierarchyUp", fields: [atasan_id], references: [id], onDelete: Cascade)
  bawahan         PersonilMonitoring[] @relation("HierarchyUp")

  createdAt       DateTime @default(now())
}
